(window.webpackJsonp=window.webpackJsonp||[]).push([[351],{707:function(e,t,a){"use strict";a.r(t);var r=a(42),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"导读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导读"}},[e._v("#")]),e._v(" 导读")]),e._v(" "),a("p",[e._v("本节标题：「小试牛刀」- 实现最基本的 React SSR")]),e._v(" "),a("p",[e._v("本节主旨：完成最简单的ssr,体验组件直出的过程")]),e._v(" "),a("p",[e._v("本节配套代码:")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/Bigerfe/koa-react-ssr/tree/better/packages/base-react-ssr",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/Bigerfe/koa-react-ssr/tree/better/packages/base-react-ssr"),a("OutboundLink")],1)]),e._v(" "),a("h1",{attrs:{id:"正文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正文"}},[e._v("#")]),e._v(" 正文")]),e._v(" "),a("p",[e._v("上一节我们介绍了"),a("code",[e._v("react ssr")]),e._v("的核心原理。")]),e._v(" "),a("p",[e._v("这一节我们就来实操一下，实现一个单纯的 "),a("code",[e._v("react ssr")]),e._v("功能，这有点像是写一个"),a("code",[e._v("hello world")]),e._v("。")]),e._v(" "),a("p",[e._v("在服务端渲染 "),a("code",[e._v("react")]),e._v(" 组件，得到组件的 "),a("code",[e._v("html")]),e._v(" 内容，然后将"),a("code",[e._v("html")]),e._v("字符串返回给浏览器端。")]),e._v(" "),a("h1",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[e._v("#")]),e._v(" 准备工作")]),e._v(" "),a("p",[a("strong",[e._v("安装 "),a("code",[e._v("react")]),e._v(" 库")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("npm i react react-dom\n\n")])])]),a("p",[a("strong",[e._v("安装 "),a("code",[e._v("babel")])])]),e._v(" "),a("p",[a("code",[e._v("react")]),e._v(" 代码不能直接运行，需要先经过 "),a("code",[e._v("babel")]),e._v(" 编译。")]),e._v(" "),a("p",[a("code",[e._v("babel7")]),e._v("和之前版本安装有所不同,是一次重大的升级，所有的包都放在了"),a("code",[e._v("@babel")]),e._v(" 下面。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("npm i @babel/core @babel/cli @babel/preset-react\n\n")])])]),a("h1",{attrs:{id:"创建组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建组件"}},[e._v("#")]),e._v(" 创建组件")]),e._v(" "),a("p",[e._v("创建一个 "),a("code",[e._v("Index")]),e._v(" 组件")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("const React = require('react');\n//组件\nclass Index extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n    render() {\n        return <h1>hello react ssr !</h1>\n    }\n}\n\n")])])]),a("h1",{attrs:{id:"创建-http-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-http-服务"}},[e._v("#")]),e._v(" 创建 http 服务")]),e._v(" "),a("p",[e._v("使用"),a("code",[e._v("node http")]),e._v(" 模块创建服务,然后调用 "),a("code",[e._v("react")]),e._v("服务端渲染"),a("code",[e._v("renderToString")]),e._v(" 方法将组件转换为 "),a("code",[e._v("html")]),e._v(" 字符串。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("//node http 模块\nconst http = require('http');\n\n//服务端渲染方法\nconst { renderToString } = require('react-dom/server');\n\n//创建服务\nhttp.createServer((req, res) => {\n        res.writeHead(200, {\n            'Content-Type': 'text/html'\n        });\n        //将组件转换为 html\n        const html = renderToString(<Index/>);\n        \n            res.end(`<!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\">\n            <title>传统 ssr</title>\n        </head>\n        <body>\n            <div id=\"root\">\n               ${html}\n            </div>\n        </body>\n        </html>\n`);\n\n    }\n).listen(9001);//服务监听9001端口\n\n")])])]),a("h1",{attrs:{id:"代码编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码编译"}},[e._v("#")]),e._v(" 代码编译")]),e._v(" "),a("p",[e._v("启动服务之前，使用 "),a("code",[e._v("babel")]),e._v(" 进行代码转换。")]),e._v(" "),a("p",[e._v("这里我们使用 "),a("code",[e._v("babel cli")]),e._v(" 命令模式行来编译代码。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("npx babel index.js --out-file index-compiled.js --presets=@babel/preset-react\n\n")])])]),a("p",[e._v("编译后的文件为："),a("code",[e._v("index-compiled.js")])]),e._v(" "),a("p",[e._v("ps: "),a("code",[e._v("npm")]),e._v(" 从 "),a("code",[e._v("5.2")]),e._v(" 版开始，增加了 "),a("code",[e._v("npx")]),e._v(" 命令，使用 "),a("code",[e._v("npx")]),e._v(" 命令可以调用项目内的模块，而不用再需要全局安装这个模块。")]),e._v(" "),a("p",[e._v("该命令执行的时候会自动安装 "),a("code",[e._v("npx")]),e._v("。")]),e._v(" "),a("p",[e._v("转换后的代码")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('class Index extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n   //jsx 语法转换为了 React.createElement 方法\n    return React.createElement("div", null, "hello react ssr!");\n  }\n\n}\n\n')])])]),a("h1",{attrs:{id:"运行服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行服务"}},[e._v("#")]),e._v(" 运行服务")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("node index-compiled.js\n\n")])])]),a("p",[e._v("访问:"),a("code",[e._v("http://localhost:9001/")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/12/27/16f467109e0f42c8?w=505&h=375&f=png&s=19776",alt:""}})]),e._v(" "),a("p",[e._v("查看网页源代码可以看到组件的 "),a("code",[e._v("html")]),e._v(" 内容")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/12/27/16f46724ba65ce20?w=505&h=375&f=png&s=46831",alt:""}})]),e._v(" "),a("p",[e._v("ok，到这里我们就实现了最基本的"),a("code",[e._v("react ssr")]),e._v("，当然这很简陋，也仅仅是个 "),a("code",[e._v("demo")]),e._v("，不过可以帮助我们具象的理解如何实现直出一个组件。")]),e._v(" "),a("p",[e._v("不要小看它，它可以帮我们引出一系列的问题，引导我们逐步的实现一个完整的 "),a("code",[e._v("ssr")]),e._v(" 应用骨架。")]),e._v(" "),a("h1",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[e._v("#")]),e._v(" 小结")]),e._v(" "),a("p",[e._v("这一节，我们实现了一个非常简单的组件直出的功能，同时对我们的理论知识进行验证。")]),e._v(" "),a("p",[e._v("其实可以看出，这和我们平时开发"),a("code",[e._v("spa")]),e._v("的项目时编写的组件没什么区别，他是可以在服务端运行的，当然这得利于一个天然的条件 - 双端的语言都是"),a("code",[e._v("javascript")]),e._v("。")]),e._v(" "),a("p",[e._v("你可以试试给组件传递一些参数，然后看看渲染效果。")]),e._v(" "),a("p",[e._v("本节完整代码:")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/Bigerfe/koa-react-ssr/tree/better/packages/base-react-ssr",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/Bigerfe/koa-react-ssr/tree/better/packages/base-react-ssr"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("感谢你的阅读。")]),e._v(" "),a("p",[e._v("如果有问题欢迎留言，也欢迎在留言区留下你的想法和思考。")])])}),[],!1,null,null,null);t.default=s.exports}}]);