(window.webpackJsonp=window.webpackJsonp||[]).push([[347],{703:function(t,e,a){"use strict";a.r(e);var n=a(42),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"导读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导读"}},[t._v("#")]),t._v(" 导读")]),t._v(" "),a("p",[t._v("本节标题：React SSR 项目实战")]),t._v(" "),a("p",[t._v("本节主旨： 通过一个小项目，来全面的感受下自己的骨架")]),t._v(" "),a("p",[t._v("本节配套代码：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/Bigerfe/koa-react-ssr/tree/better/packages/ssr-demo-simple",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Bigerfe/koa-react-ssr/tree/better/packages/ssr-demo-simple"),a("OutboundLink")],1)]),t._v(" "),a("h1",{attrs:{id:"正文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正文"}},[t._v("#")]),t._v(" 正文")]),t._v(" "),a("p",[t._v("前面我们用了大量的时间来讲述原理和以及每一步具体的实现。")]),t._v(" "),a("p",[t._v("到这里我们的应用骨架已经搭建完成，剩下的就是应用和升级。")]),t._v(" "),a("p",[t._v("本节我们就开发一个小项目，来实际的应用下这个骨架，从开发过程中感受下自己的骨架。")]),t._v(" "),a("h1",{attrs:{id:"项目介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目介绍"}},[t._v("#")]),t._v(" 项目介绍")]),t._v(" "),a("p",[t._v("本项目为仿造掘金小册页面，包括列表页和详情页面。")]),t._v(" "),a("h1",{attrs:{id:"整体页面效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体页面效果"}},[t._v("#")]),t._v(" 整体页面效果")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/21/16fc7bb14c0d8ad7?w=682&h=1023&f=png&s=138598",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/21/16fc7bb4fdb29c0e?w=682&h=1023&f=png&s=312910",alt:""}})]),t._v(" "),a("h1",{attrs:{id:"相关接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关接口"}},[t._v("#")]),t._v(" 相关接口")]),t._v(" "),a("p",[a("code",[t._v("小册列表接口")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('url:http://mockssr.bigerfe.com/list\nmethod:get\nresult:\n{\n    "code": 0,\n    "data": [\n        {\n            "des": \'\',//描述\n            "href":\'\',//详情地址\n            "id": \'\',//小册 id\n            "pic": \'\',//配图\n            "title": \'\'//小册名称\n        }\n    ]\n}\n\n')])])]),a("p",[a("code",[t._v("小册详情接口")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('url:http://mockssr.bigerfe.com/detail/:id\nmethod:get\nresult:\n{\n    "code": 0,\n    "data": {\n        "html":\'\'//小册详情\n    }\n}\n\n')])])]),a("h1",{attrs:{id:"数据请求模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据请求模块"}},[t._v("#")]),t._v(" 数据请求模块")]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("axios")]),t._v("来处理数据的请求，简单方便，兼容双端。")]),t._v(" "),a("ul",[a("li",[t._v("配置接口地址")])]),t._v(" "),a("p",[a("code",[t._v("fetch-config.js")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("export default {\n    apiHost:'http://mockssr.bigerfe.com'//接口地址\n}\n\n")])])]),a("ul",[a("li",[t._v("获取列表数据模块")])]),t._v(" "),a("p",[a("code",[t._v("get-list.js")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("import axios from 'axios';\nimport fetchConfig from './fetch-config';\n\nexport default ()=>{\n    return axios.get(`${fetchConfig.apiHost}/list`)\n        .then(function (response) {\n            return response.data;\n        })\n        .catch(function (error) {\n            console.log(error);\n        })\n}\n\n")])])]),a("ul",[a("li",[t._v("获取详情数据模块")])]),t._v(" "),a("p",[a("code",[t._v("get-detail.js")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("import axios from 'axios';\nimport fetchConfig from './fetch-config';\n\n\nexport default (id)=>{\n    return axios.get(`${fetchConfig.apiHost}/detail/${id}`)\n        .then(function (response) {\n            return response.data;\n        })\n        .catch(function (error) {\n            // handle error\n            console.log(error);\n        })\n}\n\n")])])]),a("h1",{attrs:{id:"创建页面和子组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建页面和子组件"}},[t._v("#")]),t._v(" 创建页面和子组件")]),t._v(" "),a("h2",{attrs:{id:"页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#页面"}},[t._v("#")]),t._v(" 页面")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("/pages/")]),t._v("下创建"),a("code",[t._v("index")]),t._v("和"),a("code",[t._v("detail")]),t._v("页面。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/22/16fcb963a7533c57?w=284&h=183&f=png&s=11746",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"子组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#子组件"}},[t._v("#")]),t._v(" 子组件")]),t._v(" "),a("p",[t._v("这里没有把首页的每一个"),a("code",[t._v("item")]),t._v("提取为一个组件，为了方便单独提取了一个"),a("code",[t._v("List")]),t._v("组件，用于列表的渲染。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//List 组件\nimport React from \'react\';\nimport { Link } from \'react-router-dom\';\nimport \'./index.scss\';\n\nexport default class Index extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n    render() {\n        const {list=[]} = this.props;\n\n        return <div className="book-list">\n            {\n                 list.map(item=>{\n                    return <div key={item.id} className="item">\n                        <p className="img"></p>\n                    <div className="right">\n                            <p className="title"><Link to={"/detail/" + item.id}>{item.title}</Link></p>\n                            <p className="des">{item.des}</p>\n                    </div>\n                    </div>\n                })\n            }\n        </div>\n    }\n}\n\n')])])]),a("h2",{attrs:{id:"index-页面组件-列表页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#index-页面组件-列表页面"}},[t._v("#")]),t._v(" index 页面组件(列表页面)")]),t._v(" "),a("p",[t._v("引入子组件"),a("code",[t._v("List")]),t._v(",同时设置数据预取逻辑"),a("code",[t._v("getInitialProps")]),t._v(",这里使用的是函数组件，也可以使用类组件。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("import React from 'react';\nimport {\n    Link\n} from 'react-router-dom';\nimport './index.scss';\nimport img from '../../public/img.jpg';\nimport PageContainer from '../../common/components/page-container';\n\nimport fetchGetList from '../../common/fetch/get-list';\nimport List from '../../common/components/list';\n\n\nfunction Index(props) {\n    const { fetchData } = props.initialData||{};\n    return <div className=\"page-index-box\">\n        //使用 list 组件 并将数据做为属性传入\n        <List list={fetchData}></List>\n    </div>\n}\n\nIndex.getInitialProps = async (ctx) => {\n\n    let res = await fetchGetList();\n    let data = res.code === 0 ? res.data : [];\n\n    return {\n        fetchData: data,\n        page: {\n            tdk: {\n                title: '首页 - koa-react-ssr',\n                keywords: '关键词 - koa-react-ssr',\n                description: '描述'\n            }\n        }\n    };\n}\n\nexport default PageContainer(Index); \n\n")])])]),a("h2",{attrs:{id:"detail-页面组件-详情页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#detail-页面组件-详情页面"}},[t._v("#")]),t._v(" detail 页面组件（详情页面）")]),t._v(" "),a("p",[t._v("设置数据预取和渲染逻辑。")]),t._v(" "),a("p",[t._v("列表页面使用的是类组件。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//src/client/pages/detail/index.js\n//小册详情 组件\n\nimport React from 'react';\nimport {Link} from 'react-router-dom';\nimport fetchDetail from '../../common/fetch/get-detail';\n\nimport PageContainer from '../../common/components/page-container';\n\nimport './index.scss';\n\n//组件\nclass Index extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n\n    static async  getInitialProps(ctx) {\n        let res = await fetchDetail(ctx.match.params.id);\n\n        return {\n            fetchData:res.data ||{},\n            page:{\n                tdk:{\n                    title:'小册详情 - koa-react-ssr',\n                    keywords:'koa-react-ssr',\n                    description:'koa-react-ssr'\n                }\n            }\n        };\n    }\n\n    render() {\n        //渲染数据\n        const {fetchData={}} = this.props.initialData || {};\n        const  {html}  = fetchData || null;\n        return html ? <div className=\"detail-box\" dangerouslySetInnerHTML={{ __html: html}}></div>:null\n    }\n}\n\nexport default PageContainer(Index); \n\n")])])]),a("h1",{attrs:{id:"配置路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置路由"}},[t._v("#")]),t._v(" 配置路由")]),t._v(" "),a("p",[a("code",[t._v("route-config.js")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//路由配置文件\n\n\nimport React from 'react';\n\n//组件动态加载容器\nimport AsyncLoader from './async-loader';\n\nfunction pageNotFound() {\n    return <div>404页面</div>\n}\n\nexport default [\n    {\n        path: ['/','/index'],\n        component: AsyncLoader(() => import('../pages/index')),\n        exact:true\n    },\n    {\n        path: '/detail/:id',\n        component: AsyncLoader(() => import('../pages/detail')),\n        exact: true\n    },\n    {\n        path: '*',\n        component: pageNotFound,\n        exact: true\n    }\n]\n\n")])])]),a("h1",{attrs:{id:"本地开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地开发"}},[t._v("#")]),t._v(" 本地开发")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm run dev\n\n")])])]),a("h1",{attrs:{id:"生产环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产环境"}},[t._v("#")]),t._v(" 生产环境")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm run build\n\n")])])]),a("h1",{attrs:{id:"生产环境预览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产环境预览"}},[t._v("#")]),t._v(" 生产环境预览")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm run prod:start\n\n")])])]),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/22/16fcba0872394fde?w=1048&h=1023&f=png&s=229778",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/22/16fcba0c154af9af?w=1048&h=1023&f=png&s=475675",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/22/16fcba15da0b70c7?w=1048&h=1023&f=png&s=925172",alt:""}})]),t._v(" "),a("h1",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),a("p",[t._v("本节主要是通过一个实际的项目来了解下如何基于我们的应用骨架进行开发，整体来看还是比较简单的。")]),t._v(" "),a("p",[t._v("这个项目未使用"),a("code",[t._v("redux")]),t._v("做状态管理，不过我们前面已经完成了基于状态管理的骨架，如果进行改造的话也是很容易的。")]),t._v(" "),a("p",[t._v("本节完整代码已上传")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/Bigerfe/koa-react-ssr/tree/better/packages/ssr-demo-simple",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Bigerfe/koa-react-ssr/tree/better/packages/ssr-demo-simple"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("感谢你的阅读。")]),t._v(" "),a("p",[t._v("如果有问题欢迎留言，也欢迎在留言区留下你的想法和思考。")])])}),[],!1,null,null,null);e.default=s.exports}}]);