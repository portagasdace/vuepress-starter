(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{473:function(t,e,a){"use strict";a.r(e);var n=a(42),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"存取本地数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存取本地数据"}},[t._v("#")]),t._v(" 存取本地数据")]),t._v(" "),a("p",[t._v("本节要实现一个功能：打开 APP 的时候是上次选择的城市。")]),t._v(" "),a("p",[t._v("所以需要把选择的城市的数据保存起来，这个时候需要用到第三方库："),a("code",[t._v("shared_preferences")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"添加第三方库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加第三方库"}},[t._v("#")]),t._v(" 添加第三方库")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("pubspec.yaml")]),t._v(" 里添加：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("dependencies:\n  shared_preferences: ^0.5.2\n\n")])])]),a("p",[t._v("然后运行：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("flutter packages get\n\n")])])]),a("h2",{attrs:{id:"读取数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读取数据"}},[t._v("#")]),t._v(" 读取数据")]),t._v(" "),a("p",[t._v("在 HotWidgetState 的 initState() 里增加一个读取数据的方法 initData(),注意这里读取数据是异步的，所以 initData() 方法要加 async：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("class HotWidgetState extends State<HotWidget> {\n  String curCity;\n\n  @override\n  void initState() {\n    // TODO: implement initState\n    super.initState();\n    print('HotWidgetState initState');\n    initData();\n  }\n\n  void initData() async {\n    final prefs = await SharedPreferences.getInstance();//获取 prefs\n\n    String city = prefs.getString('curCity');//获取 key 为 curCity 的值\n\n    if (city != null && city.isNotEmpty) { //如果有值\n      setState((){\n        curCity = city;\n      });\n    } else {//如果没有值，则使用默认值\n      setState((){\n        curCity = '深圳';\n      });\n    }\n  }\n  ...\n}\n\n")])])]),a("h2",{attrs:{id:"ui-改造"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ui-改造"}},[t._v("#")]),t._v(" UI 改造")]),t._v(" "),a("p",[t._v("因为读取数据是异步的，在 build Widget 的时候 curCity 可能就是空的，这样会导致拉取不到数据，所以 UI 这里要加一个逻辑，如果 curCity 不为空，就返回电影的UI,否则返回刷新界面：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Widget build(BuildContext context) {\n    // TODO: implement build\n    if (curCity != null && curCity.isNotEmpty) {//如果 curCity 不为空\n      return Column(\n        ...\n      );\n    } else {//如果 curCity 为空\n      return Center(\n        child: CircularProgressIndicator(),\n      );\n    }\n  }\n\n")])])]),a("p",[t._v("效果为：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/4/29/16a68264bd5fd0b2?w=480&h=960&f=gif&s=201709",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"存取数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存取数据"}},[t._v("#")]),t._v(" 存取数据")]),t._v(" "),a("p",[t._v("在 _jumpToCitysWidget 里增加存取数据的代码:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  void _jumpToCitysWidget() async {\n    var selectCity =\n        await Navigator.pushNamed(context, '/Citys', arguments: curCity);\n    if (selectCity == null) return;\n\n    final prefs = await SharedPreferences.getInstance(); \n    prefs.setString('curCity', selectCity); //存取数据\n\n    setState(() {\n      curCity = selectCity;\n    });\n  }\n\n")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);